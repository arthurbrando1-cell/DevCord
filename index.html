<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevCord | Discord Clone</title>
    <style>
        :root {
            --bg-servers: #1e1f22;
            --bg-channels: #2b2d31;
            --bg-chat: #313338;
            --bg-input: #383a40;
            --bg-modal: #ffffff;
            --accent: #5865f2;
            --success: #23a559;
            --text-main: #dbdee1;
            --text-muted: #949ba4;
            --text-dark: #313338;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'gg sans', sans-serif; background: var(--bg-chat); color: var(--text-main); overflow: hidden; }

        /* Estilo do App Layout */
        #app { display: flex; height: 100vh; visibility: hidden; }

        /* Sidebar Servidores */
        .sidebar-servers { width: 72px; background: var(--bg-servers); display: flex; flex-direction: column; align-items: center; padding-top: 12px; gap: 8px; flex-shrink: 0; }
        
        .discord-home { width: 48px; height: 48px; background: var(--bg-chat); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; margin-bottom: 4px; }
        .discord-home svg { fill: var(--text-main); width: 28px; }
        .discord-home:hover { border-radius: 16px; background: var(--accent); }
        .discord-home:hover svg { fill: white; }

        .separator { width: 32px; height: 2px; background: var(--bg-input); border-radius: 1px; margin-bottom: 8px; }

        .server-icon { 
            width: 48px; height: 48px; background: var(--bg-chat); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; 
            transition: 0.2s; font-weight: 500; position: relative; background-size: cover; background-position: center;
        }
        .server-icon:hover, .server-icon.active { border-radius: 16px; background-color: var(--accent); color: white; }
        .server-icon.active::before { content: ""; position: absolute; left: -12px; width: 4px; height: 40px; background: white; border-radius: 0 4px 4px 0; }

        /* Modal Customizado (Cria√ß√£o de Servidor) */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
            display: none; align-items: center; justify-content: center; z-index: 3000; 
        }
        .modal-card { 
            background: var(--bg-modal); color: var(--text-dark); padding: 24px; 
            border-radius: 8px; width: 440px; text-align: center; position: relative;
        }
        .modal-card h2 { margin: 0 0 8px; font-size: 24px; color: #060607; }
        .modal-card p { color: #4e5058; margin-bottom: 20px; }
        .modal-card input { 
            width: 100%; padding: 10px; margin-top: 8px; border-radius: 3px; 
            border: none; background: #ebedef; color: #313338; box-sizing: border-box;
        }
        .modal-footer { background: #f2f3f5; margin: 24px -24px -24px; padding: 16px 24px; border-radius: 0 0 8px 8px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Barra de Input e Emojis */
        .input-area { padding: 0 16px 24px; position: relative; }
        .input-wrapper { background: var(--bg-input); border-radius: 8px; display: flex; align-items: center; padding: 0 12px; }
        #message-input { flex-grow: 1; padding: 12px; background: transparent; border: none; color: white; outline: none; }
        .emoji-btn { cursor: pointer; font-size: 20px; filter: grayscale(1); transition: 0.2s; }
        .emoji-btn:hover { filter: grayscale(0); transform: scale(1.1); }
        
        .emoji-picker { 
            position: absolute; bottom: 80px; right: 20px; background: var(--bg-channels); 
            padding: 10px; border-radius: 8px; display: none; grid-template-columns: repeat(5, 1fr); gap: 5px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 100;
        }
        .emoji-picker span { cursor: pointer; font-size: 20px; padding: 5px; }
        .emoji-picker span:hover { background: var(--bg-input); border-radius: 4px; }

        /* Estilos de Mensagem */
        #msg-container { flex-grow: 1; overflow-y: auto; padding: 20px 0; }
        .message { display: flex; gap: 16px; padding: 4px 16px; margin-top: 10px; }
        .message:hover { background: rgba(0,0,0,0.05); }
        .msg-avatar { width: 40px; height: 40px; border-radius: 50%; background-size: cover; background-position: center; flex-shrink: 0; }
        .msg-user { font-weight: 600; color: white; margin-right: 8px; cursor: pointer; }
        .msg-user:hover { text-decoration: underline; }

        .auth-btn-blue { background: var(--accent); color: white; padding: 10px 24px; border: none; border-radius: 3px; cursor: pointer; font-weight: 500; }
    </style>
</head>
<body>

    <div id="modal-create" class="modal-overlay">
        <div class="modal-card">
            <h2>Personalize seu servidor</h2>
            <p>D√™ ao seu novo servidor uma personalidade com um nome e um √≠cone.</p>
            <div style="text-align: left;">
                <label style="font-weight: bold; font-size: 12px; color: #4e5058;">URL DA IMAGEM DO √çCONE</label>
                <input type="text" id="srv-icon-input" placeholder="https://link-da-imagem.com/foto.png">
                <br><br>
                <label style="font-weight: bold; font-size: 12px; color: #4e5058;">NOME DO SERVIDOR</label>
                <input type="text" id="srv-name-input" placeholder="Servidor de Estudos">
            </div>
            <div class="modal-footer">
                <span style="cursor:pointer; font-weight:500;" onclick="closeModal()">Voltar</span>
                <button class="auth-btn-blue" id="confirm-create">Criar</button>
            </div>
        </div>
    </div>

    <div id="app">
        <nav class="sidebar-servers">
            <div class="discord-home"><svg viewBox="0 0 28 20"><path d="M23.0212 1.67671C21.3107 0.883335 19.4805 0.314895 17.5605 0.000305176C17.5268 -0.0045144 17.4958 0.0102654 17.478 0.0392349C17.2488 0.449013 16.9953 0.97906 16.8164 1.3995C14.7601 1.09117 12.7153 1.09117 10.6865 1.3995C10.5076 0.97906 10.2458 0.449013 10.0163 0.0392349C9.9985 0.0102654 9.96752 -0.0045144 9.9338 0.000305176C8.01384 0.314895 6.18361 0.883335 4.47308 1.67671C4.45934 1.68314 4.44781 1.69374 4.44047 1.70724C0.998492 6.84883 -0.0526749 11.8706 0.41446 16.8286C0.415842 16.8437 0.425313 16.8575 0.437976 16.8665C2.71186 18.533 4.9137 19.5443 7.07629 20.2114C7.11072 20.2221 7.14723 20.2102 7.16875 20.1818C7.68322 19.4795 8.14041 18.7303 8.52935 17.9421C8.5522 17.8955 8.52984 17.8405 8.48152 17.8222C7.75619 17.5463 7.06209 17.2096 6.40191 16.8145C6.35038 16.7833 6.34701 16.711 6.39513 16.675C6.53613 16.5689 6.67385 16.4587 6.80521 16.3452C6.82944 16.324 6.86311 16.3195 6.89069 16.332C11.1682 18.2863 15.8587 18.2863 20.0893 16.332C20.1169 16.3195 20.1506 16.324 20.1748 16.3452C20.3061 16.4587 20.4439 16.5689 20.5849 16.675C20.633 16.711 20.6296 16.7833 20.5781 16.8145C19.9179 17.2096 19.2238 17.5463 18.4985 17.8222C18.4502 17.8405 18.4278 17.8955 18.4507 17.9421C18.8396 18.7303 19.2968 19.4795 19.8113 20.1818C19.8328 20.2102 19.8693 20.2221 19.9037 20.2114C22.0663 19.5443 24.2681 18.533 26.542 16.8665C26.5547 16.8575 26.5641 16.8437 26.5655 16.8286C27.1147 11.1148 25.6457 6.13608 23.0538 1.70724C23.0465 1.69374 23.0349 1.68314 23.0212 1.67671ZM9.67332 13.9213C8.37563 13.9213 7.3082 12.7237 7.3082 11.2505C7.3082 9.77726 8.35332 8.57963 9.67332 8.57963C11.006 8.57963 12.0524 9.77726 12.0375 11.2505C12.0375 12.7237 11.006 13.9213 9.67332 13.9213ZM17.3611 13.9213C16.0634 13.9213 14.996 12.7237 14.996 11.2505C14.996 9.77726 16.0411 8.57963 17.3611 8.57963C18.6938 8.57963 19.7402 9.77726 19.7253 11.2505C19.7253 12.7237 18.6938 13.9213 17.3611 13.9213Z"/></svg></div>
            <div class="separator"></div>
            <div id="my-servers"></div>
            <div class="server-icon icon-green" onclick="openCreateModal()" style="color:#23a559; font-size: 24px;">+</div>
        </nav>

        <aside class="sidebar-channels">
            <div class="header" id="srv-name">DevCord</div>
            <div style="padding:10px 16px; color:var(--text-muted); font-size:12px;">CANAIS DE TEXTO</div>
            <div style="padding:6px 16px; color:white; background:rgba(255,255,255,0.05); border-radius:4px; margin:0 8px; cursor:pointer"># geral</div>
        </aside>

        <main class="chat-area">
            <div class="header"># <span id="chan-name" style="margin-left:5px">selecione um servidor</span></div>
            <div id="msg-container"></div>
            
            <div class="input-area">
                <div class="emoji-picker" id="emoji-picker">
                    <span onclick="addEmoji('üòÄ')">üòÄ</span><span onclick="addEmoji('üòÇ')">üòÇ</span><span onclick="addEmoji('üî•')">üî•</span>
                    <span onclick="addEmoji('üöÄ')">üöÄ</span><span onclick="addEmoji('üíª')">üíª</span><span onclick="addEmoji('üëç')">üëç</span>
                    <span onclick="addEmoji('üëÄ')">üëÄ</span><span onclick="addEmoji('‚ú®')">‚ú®</span><span onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                    <span onclick="addEmoji('‚úÖ')">‚úÖ</span>
                </div>
                <div class="input-wrapper">
                    <input type="text" id="message-input" placeholder="Conversar em #geral">
                    <div class="emoji-btn" onclick="toggleEmoji()">üòÄ</div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, setDoc, doc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Mantenha suas configura√ß√µes do Firebase aqui...
        const firebaseConfig = {
            apiKey: "AIzaSyD6mo_rK6_4-RtaR8Wzg9UxWy7HaqnKNE8",
            authDomain: "devcord-4dcf6.firebaseapp.com",
            projectId: "devcord-4dcf6",
            storageBucket: "devcord-4dcf6.firebasestorage.app",
            messagingSenderId: "168388878048",
            appId: "1:168388878048:web:c4b9628253e4b46c077a85"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // FUN√á√ïES DE MODAL
        window.openCreateModal = () => document.getElementById('modal-create').style.display = 'flex';
        window.closeModal = () => document.getElementById('modal-create').style.display = 'none';

        // L√ìGICA DE CRIAR SERVIDOR
        document.getElementById('confirm-create').onclick = async () => {
            const nome = document.getElementById('srv-name-input').value;
            const foto = document.getElementById('srv-icon-input').value || "";
            
            if (nome.trim()) {
                const docRef = await addDoc(collection(db, "todos_servidores"), { 
                    nome, 
                    foto, 
                    dono: auth.currentUser.uid, 
                    createdAt: serverTimestamp() 
                });
                await setDoc(doc(db, "membros", `${auth.currentUser.uid}_${docRef.id}`), { 
                    uid: auth.currentUser.uid, 
                    srvId: docRef.id 
                });
                closeModal();
                document.getElementById('srv-name-input').value = "";
                document.getElementById('srv-icon-input').value = "";
            }
        };

        // EMOJIS
        window.toggleEmoji = () => {
            const p = document.getElementById('emoji-picker');
            p.style.display = p.style.display === 'grid' ? 'none' : 'grid';
        };
        window.addEmoji = (emoji) => {
            document.getElementById('message-input').value += emoji;
            toggleEmoji();
            document.getElementById('message-input').focus();
        };

        // Renderiza√ß√£o de √≠cones com suporte a imagem
        function renderSrvIcon(srv) {
            const list = document.getElementById('my-servers');
            const div = document.createElement('div');
            div.className = 'server-icon';
            if(srv.foto) {
                div.style.backgroundImage = `url('${srv.foto}')`;
                div.innerText = "";
            } else {
                div.innerText = srv.nome[0].toUpperCase();
            }
            div.onclick = () => { /* Sua fun√ß√£o de carregar chat aqui */ };
            list.appendChild(div);
        }

        // ... Restante do seu c√≥digo de monitoramento do Firebase (onSnapshot) ...
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('app').style.visibility = 'visible';
                // Chamar suas fun√ß√µes de escuta aqui
            }
        });
    </script>
</body>
</html>
