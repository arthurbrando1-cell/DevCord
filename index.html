<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevCord | Explorar</title>
    <style>
        :root {
            --bg-servers: #1e1f22;
            --bg-channels: #2b2d31;
            --bg-chat: #313338;
            --bg-input: #383a40;
            --accent: #5865f2;
            --success: #23a559;
            --text-main: #dbdee1;
            --text-muted: #949ba4;
            --white: #ffffff;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'gg sans', 'Segoe UI', Tahoma, sans-serif; background: var(--bg-chat); color: var(--text-main); overflow: hidden; }

        /* Auth Screen */
        #auth-overlay { position: fixed; inset: 0; background: #313338; display: flex; align-items: center; justify-content: center; z-index: 2000; background-image: url('https://discord.com/assets/8a83754d7744037bc1ba.svg'); background-size: cover; }
        .auth-box { background: #313338; padding: 32px; border-radius: 8px; width: 400px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .auth-box input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 4px; border: none; background: #1e1f22; color: white; box-sizing: border-box; }
        .auth-btn { width: 100%; padding: 12px; background: var(--accent); border: none; color: white; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background 0.2s; }
        .auth-btn:hover { background: #4752c4; }

        /* App Layout */
        #app { display: flex; height: 100vh; visibility: hidden; }

        /* Sidebar Servidores */
        .sidebar-servers { width: 72px; background: var(--bg-servers); display: flex; flex-direction: column; align-items: center; padding-top: 12px; gap: 8px; overflow-y: auto; flex-shrink: 0; }
        
        /* Botão Logo Discord */
        .discord-home {
            width: 48px; height: 48px; background: var(--bg-chat); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; margin-bottom: 4px;
        }
        .discord-home svg { fill: var(--text-main); width: 28px; transition: 0.3s; }
        .discord-home:hover { border-radius: 16px; background: var(--accent); }
        .discord-home:hover svg { fill: white; }

        .separator { width: 32px; height: 2px; background: var(--bg-input); border-radius: 1px; margin-bottom: 8px; }

        .server-icon { 
            width: 48px; height: 48px; background: var(--bg-chat); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: 0.2s; font-weight: 500; position: relative; flex-shrink: 0;
            color: var(--text-main); text-decoration: none;
        }
        .server-icon:hover, .server-icon.active { border-radius: 16px; background: var(--accent); color: white; }
        
        /* Indicador Lateral (Pílula branca) */
        .server-icon.active::before { content: ""; position: absolute; left: -12px; width: 4px; height: 40px; background: white; border-radius: 0 4px 4px 0; }
        .server-icon:hover:not(.active)::before { content: ""; position: absolute; left: -12px; width: 4px; height: 20px; background: white; border-radius: 0 4px 4px 0; }

        .icon-green { color: var(--success); }
        .icon-green:hover { background: var(--success) !important; color: white; }

        /* Canais e Chat */
        .sidebar-channels { width: 240px; background: var(--bg-channels); display: flex; flex-direction: column; border-top-left-radius: 8px; }
        .header { height: 48px; display: flex; align-items: center; padding: 0 16px; font-weight: bold; box-shadow: 0 1px 0 rgba(0,0,0,0.1), 0 1.5px 0 rgba(0,0,0,0.05); z-index: 10; font-size: 15px; }
        
        .chat-area { flex-grow: 1; display: flex; flex-direction: column; background: var(--bg-chat); }
        #msg-container { flex-grow: 1; overflow-y: auto; padding: 20px 0; display: flex; flex-direction: column; }
        
        .message { display: flex; gap: 16px; padding: 2px 16px; transition: background 0.1s; margin-top: 15px; }
        .message:hover { background: rgba(0,0,0,0.05); }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; flex-shrink: 0; }
        .msg-content { display: flex; flex-direction: column; }
        .msg-user { font-weight: 500; color: white; font-size: 1rem; margin-right: 8px; }
        .msg-text { color: var(--text-main); font-size: 0.95rem; line-height: 1.3; }

        .input-area { padding: 0 16px 24px 16px; }
        #message-input { 
            width: 100%; padding: 11px; background: var(--bg-input); border: none; 
            border-radius: 8px; color: var(--text-main); outline: none; box-sizing: border-box;
        }

        /* Modal de Busca */
        #search-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 1500; }
        .search-box { background: var(--bg-channels); padding: 24px; border-radius: 8px; width: 440px; }
        .search-item { padding: 10px; background: var(--bg-servers); margin: 8px 0; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-box">
            <h2 style="color: white; margin-bottom: 8px;">Boas-vindas de volta!</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px;">Estamos muito animados em te ver novamente!</p>
            <input type="email" id="email" placeholder="E-mail">
            <input type="password" id="password" placeholder="Senha">
            <button class="auth-btn" id="btn-auth">Entrar / Registrar</button>
        </div>
    </div>

    <div id="search-modal">
        <div class="search-box">
            <h3 style="margin-top:0">Explorar Servidores</h3>
            <div id="search-results"></div>
            <button class="auth-btn" style="margin-top:20px" onclick="document.getElementById('search-modal').style.display='none'">Fechar</button>
        </div>
    </div>

    <div id="app">
        <nav class="sidebar-servers">
            <div class="discord-home" title="Mensagens Diretas">
                <svg viewBox="0 0 28 20"><path d="M23.0212 1.67671C21.3107 0.883335 19.4805 0.314895 17.5605 0.000305176C17.5268 -0.0045144 17.4958 0.0102654 17.478 0.0392349C17.2488 0.449013 16.9953 0.97906 16.8164 1.3995C14.7601 1.09117 12.7153 1.09117 10.6865 1.3995C10.5076 0.97906 10.2458 0.449013 10.0163 0.0392349C9.9985 0.0102654 9.96752 -0.0045144 9.9338 0.000305176C8.01384 0.314895 6.18361 0.883335 4.47308 1.67671C4.45934 1.68314 4.44781 1.69374 4.44047 1.70724C0.998492 6.84883 -0.0526749 11.8706 0.41446 16.8286C0.415842 16.8437 0.425313 16.8575 0.437976 16.8665C2.71186 18.533 4.9137 19.5443 7.07629 20.2114C7.11072 20.2221 7.14723 20.2102 7.16875 20.1818C7.68322 19.4795 8.14041 18.7303 8.52935 17.9421C8.5522 17.8955 8.52984 17.8405 8.48152 17.8222C7.75619 17.5463 7.06209 17.2096 6.40191 16.8145C6.35038 16.7833 6.34701 16.711 6.39513 16.675C6.53613 16.5689 6.67385 16.4587 6.80521 16.3452C6.82944 16.324 6.86311 16.3195 6.89069 16.332C11.1682 18.2863 15.8587 18.2863 20.0893 16.332C20.1169 16.3195 20.1506 16.324 20.1748 16.3452C20.3061 16.4587 20.4439 16.5689 20.5849 16.675C20.633 16.711 20.6296 16.7833 20.5781 16.8145C19.9179 17.2096 19.2238 17.5463 18.4985 17.8222C18.4502 17.8405 18.4278 17.8955 18.4507 17.9421C18.8396 18.7303 19.2968 19.4795 19.8113 20.1818C19.8328 20.2102 19.8693 20.2221 19.9037 20.2114C22.0663 19.5443 24.2681 18.533 26.542 16.8665C26.5547 16.8575 26.5641 16.8437 26.5655 16.8286C27.1147 11.1148 25.6457 6.13608 23.0538 1.70724C23.0465 1.69374 23.0349 1.68314 23.0212 1.67671ZM9.67332 13.9213C8.37563 13.9213 7.3082 12.7237 7.3082 11.2505C7.3082 9.77726 8.35332 8.57963 9.67332 8.57963C11.006 8.57963 12.0524 9.77726 12.0375 11.2505C12.0375 12.7237 11.006 13.9213 9.67332 13.9213ZM17.3611 13.9213C16.0634 13.9213 14.996 12.7237 14.996 11.2505C14.996 9.77726 16.0411 8.57963 17.3611 8.57963C18.6938 8.57963 19.7402 9.77726 19.7253 11.2505C19.7253 12.7237 18.6938 13.9213 17.3611 13.9213Z"/></svg>
            </div>
            <div class="separator"></div>
            
            <div id="my-servers"></div>
            
            <div class="server-icon icon-green" id="btn-add-server" title="Adicionar um Servidor">+</div>
            <div class="server-icon icon-green" id="btn-search-server" title="Explorar Servidores Públicos">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            </div>
        </nav>
        
        <aside class="sidebar-channels">
            <div class="header" id="srv-name">DevCord</div>
            <div style="padding:10px 16px; color:var(--text-muted); font-size: 14px; font-weight: 500;"># GERAL</div>
            
            <div style="margin-top:auto; padding:10px; background:#232428; display: flex; align-items: center; gap: 8px;">
                <div class="avatar" style="width:32px; height:32px; font-size: 12px;">U</div>
                <div style="flex-grow:1; overflow: hidden;">
                    <div id="user-tag" style="font-weight:bold; font-size:13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">User</div>
                    <div style="font-size:11px; color:var(--text-muted)">Disponível</div>
                </div>
                <span id="btn-logout" style="color:var(--text-muted); cursor:pointer; font-size:18px" title="Sair">⚙️</span>
            </div>
        </aside>

        <main class="chat-area">
            <div class="header">
                <span style="color:var(--text-muted); font-size: 20px; margin-right: 8px;">#</span>
                <span id="chan-name">selecione um servidor</span>
            </div>
            
            <div id="msg-container"></div>
            
            <div class="input-area">
                <input type="text" id="message-input" placeholder="Conversar em #geral">
            </div>
        </main>
    </div>

<script type="module">
    // (Mantenha seu script do Firebase exatamente como estava, ele funcionará com o novo HTML/CSS)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, setDoc, doc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD6mo_rK6_4-RtaR8Wzg9UxWy7HaqnKNE8",
        authDomain: "devcord-4dcf6.firebaseapp.com",
        projectId: "devcord-4dcf6",
        storageBucket: "devcord-4dcf6.firebasestorage.app",
        messagingSenderId: "168388878048",
        appId: "1:168388878048:web:c4b9628253e4b46c077a85"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentSrvId = null;
    let unsubMsgs = null;

    document.getElementById('btn-auth').onclick = async () => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        try {
            await signInWithEmailAndPassword(auth, email, pass);
        } catch {
            await createUserWithEmailAndPassword(auth, email, pass);
        }
    };

    document.getElementById('btn-logout').onclick = () => signOut(auth);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('auth-overlay').style.display = 'none';
            document.getElementById('app').style.visibility = 'visible';
            document.getElementById('user-tag').innerText = user.email.split('@')[0];
            listenMyServers();
        } else {
            document.getElementById('auth-overlay').style.display = 'flex';
            document.getElementById('app').style.visibility = 'hidden';
        }
    });

    function listenMyServers() {
        const q = query(collection(db, "membros"), where("uid", "==", auth.currentUser.uid));
        onSnapshot(q, async (snapshot) => {
            const list = document.getElementById('my-servers');
            list.innerHTML = '';
            for (const memberDoc of snapshot.docs) {
                const srvId = memberDoc.data().srvId;
                const srvSnap = await getDocs(query(collection(db, "todos_servidores"), where("__name__", "==", srvId)));
                srvSnap.forEach(d => renderSrvIcon({id: d.id, ...d.data()}));
            }
        });
    }

    function renderSrvIcon(srv) {
        const list = document.getElementById('my-servers');
        const div = document.createElement('div');
        div.className = `server-icon ${currentSrvId === srv.id ? 'active' : ''}`;
        div.innerText = srv.nome[0].toUpperCase();
        div.onclick = () => { 
            currentSrvId = srv.id; 
            document.getElementById('srv-name').innerText = srv.nome; 
            loadChat(srv.id); 
            listenMyServers(); 
        };
        list.appendChild(div);
    }

    document.getElementById('btn-add-server').onclick = async () => {
        const nome = prompt("Nome do Servidor:");
        if (nome) {
            const docRef = await addDoc(collection(db, "todos_servidores"), { nome, dono: auth.currentUser.uid, createdAt: serverTimestamp() });
            await setDoc(doc(db, "membros", `${auth.currentUser.uid}_${docRef.id}`), { uid: auth.currentUser.uid, srvId: docRef.id });
        }
    };

    document.getElementById('btn-search-server').onclick = async () => {
        document.getElementById('search-modal').style.display = 'flex';
        const results = document.getElementById('search-results');
        results.innerHTML = 'Carregando...';
        const snap = await getDocs(collection(db, "todos_servidores"));
        results.innerHTML = '';
        snap.forEach(docSnap => {
            const srv = docSnap.data();
            const div = document.createElement('div');
            div.className = 'search-item';
            div.innerHTML = `<span>${srv.nome}</span> <button class="auth-btn" style="width:80px; padding:5px">Entrar</button>`;
            div.onclick = async () => {
                await setDoc(doc(db, "membros", `${auth.currentUser.uid}_${docSnap.id}`), { uid: auth.currentUser.uid, srvId: docSnap.id });
                document.getElementById('search-modal').style.display = 'none';
            };
            results.appendChild(div);
        });
    };

    function loadChat(srvId) {
        if (unsubMsgs) unsubMsgs();
        document.getElementById('chan-name').innerText = "geral";
        const q = query(collection(db, `mensagens_${srvId}`), orderBy("createdAt", "asc"));
        unsubMsgs = onSnapshot(q, (snap) => {
            const cont = document.getElementById('msg-container');
            cont.innerHTML = '';
            snap.forEach(d => {
                const data = d.data();
                const m = document.createElement('div');
                m.className = 'message';
                m.innerHTML = `
                    <div class="avatar">${data.user[0].toUpperCase()}</div>
                    <div class="msg-content">
                        <div><span class="msg-user">${data.user}</span><span style="font-size:10px; color:var(--text-muted)">Hoje às 12:00</span></div>
                        <div class="msg-text">${data.text}</div>
                    </div>`;
                cont.appendChild(m);
            });
            cont.scrollTop = cont.scrollHeight;
        });
    }

    document.getElementById('message-input').onkeypress = async (e) => {
        if (e.key === 'Enter' && currentSrvId && e.target.value.trim() !== "") {
            const text = e.target.value; e.target.value = "";
            await addDoc(collection(db, `mensagens_${currentSrvId}`), { text, user: auth.currentUser.email.split('@')[0], createdAt: serverTimestamp() });
        }
    };
</script>
</body>
</html>
